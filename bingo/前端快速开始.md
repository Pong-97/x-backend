# å‰ç«¯å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿæ¥å…¥

### 1. API åŸºç¡€é…ç½®

#### ç¯å¢ƒå˜é‡é…ç½®
```javascript
// .env.development (æœ¬åœ°å¼€å‘)
VITE_API_BASE_URL=http://localhost:3000

// .env.production (ç”Ÿäº§ç¯å¢ƒ)
VITE_API_BASE_URL=https://lyaftwgtwyqr.sealosbja.site
```

#### Axios å®ä¾‹é…ç½®
```javascript
// utils/request.js
import axios from 'axios'
import { ElMessage } from 'element-plus' // æˆ–å…¶ä»–UIåº“çš„æ¶ˆæ¯æç¤º

const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// è¯·æ±‚æ‹¦æˆªå™¨ - æ·»åŠ  token
request.interceptors.request.use(
  config => {
    const token = localStorage.getItem('token')
    if (token) {
      config.headers.Authorization = `Bearer ${token}`
    }
    return config
  },
  error => {
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨ - ç»Ÿä¸€å¤„ç†
request.interceptors.response.use(
  response => {
    const { code, message, data } = response.data
    
    if (code === 200) {
      return data // ç›´æ¥è¿”å› data éƒ¨åˆ†
    } else {
      ElMessage.error(message || 'è¯·æ±‚å¤±è´¥')
      return Promise.reject(new Error(message))
    }
  },
  error => {
    if (error.response) {
      const { status, data } = error.response
      
      switch (status) {
        case 401:
          ElMessage.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•')
          localStorage.removeItem('token')
          localStorage.removeItem('userInfo')
          // è·³è½¬åˆ°ç™»å½•é¡µ
          window.location.href = '/login'
          break
        case 403:
          ElMessage.error('æ²¡æœ‰æƒé™è®¿é—®')
          break
        case 404:
          ElMessage.error('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨')
          break
        case 500:
          ElMessage.error('æœåŠ¡å™¨é”™è¯¯')
          break
        default:
          ElMessage.error(data?.message || 'è¯·æ±‚å¤±è´¥')
      }
    } else {
      ElMessage.error('ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥')
    }
    
    return Promise.reject(error)
  }
)

export default request
```

---

## ğŸ“¦ API æ¨¡å—å°è£…

### ç”¨æˆ·ç›¸å…³ API
```javascript
// api/user.js
import request from '@/utils/request'

export const userAPI = {
  // ç”¨æˆ·æ³¨å†Œ
  register(data) {
    return request.post('/user/register', data)
  },

  // ç”¨æˆ·ç™»å½•
  login(data) {
    return request.post('/user/login', data)
  },

  // è·å–ç”¨æˆ·ä¿¡æ¯
  getUserInfo() {
    return request.get('/user/info')
  },

  // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
  updateUserInfo(data) {
    return request.post('/user/update', data)
  }
}
```

### å•†å“ç›¸å…³ API
```javascript
// api/product.js
import request from '@/utils/request'

export const productAPI = {
  // è·å–å•†å“åˆ—è¡¨
  getList(params) {
    return request.get('/product/list', { params })
  },

  // è·å–å•†å“è¯¦æƒ…
  getDetail(id) {
    return request.get(`/product/${id}`)
  },

  // æœç´¢å•†å“
  search(params) {
    return request.get('/product/search', { params })
  }
}
```

### è´­ç‰©è½¦ç›¸å…³ API
```javascript
// api/cart.js
import request from '@/utils/request'

export const cartAPI = {
  // è·å–è´­ç‰©è½¦åˆ—è¡¨
  getList() {
    return request.get('/cart/list')
  },

  // æ·»åŠ åˆ°è´­ç‰©è½¦
  add(data) {
    return request.post('/cart/add', data)
  },

  // æ›´æ–°è´­ç‰©è½¦
  update(data) {
    return request.post('/cart/update', data)
  },

  // åˆ é™¤è´­ç‰©è½¦å•†å“
  delete(id) {
    return request.delete(`/cart/delete/${id}`)
  }
}
```

### è®¢å•ç›¸å…³ API
```javascript
// api/order.js
import request from '@/utils/request'

export const orderAPI = {
  // åˆ›å»ºè®¢å•
  create(data) {
    return request.post('/order/create', data)
  },

  // è·å–è®¢å•åˆ—è¡¨
  getList(params) {
    return request.get('/order/list', { params })
  },

  // è·å–è®¢å•è¯¦æƒ…
  getDetail(id) {
    return request.get(`/order/${id}`)
  },

  // å–æ¶ˆè®¢å•
  cancel(id) {
    return request.post(`/order/cancel/${id}`)
  },

  // ç¡®è®¤æ”¶è´§
  confirm(id) {
    return request.post(`/order/confirm/${id}`)
  },

  // åˆ é™¤è®¢å•
  delete(id) {
    return request.delete(`/order/delete/${id}`)
  }
}
```

### åœ°å€ç›¸å…³ API
```javascript
// api/address.js
import request from '@/utils/request'

export const addressAPI = {
  // è·å–åœ°å€åˆ—è¡¨
  getList() {
    return request.get('/address/list')
  },

  // æ·»åŠ åœ°å€
  add(data) {
    return request.post('/address/add', data)
  },

  // æ›´æ–°åœ°å€
  update(id, data) {
    return request.post(`/address/update/${id}`, data)
  },

  // åˆ é™¤åœ°å€
  delete(id) {
    return request.delete(`/address/delete/${id}`)
  },

  // è®¾ç½®é»˜è®¤åœ°å€
  setDefault(id) {
    return request.post(`/address/setDefault/${id}`)
  }
}
```

### åˆ†ç±»å’Œé¦–é¡µ API
```javascript
// api/common.js
import request from '@/utils/request'

export const commonAPI = {
  // è·å–åˆ†ç±»åˆ—è¡¨
  getCategoryList() {
    return request.get('/category/list')
  },

  // è·å–é¦–é¡µæ•°æ®
  getHomeData() {
    return request.get('/home')
  },

  // å¥åº·æ£€æŸ¥
  healthCheck() {
    return request.get('/health')
  }
}
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### 1. ç™»å½•æµç¨‹
```vue
<script setup>
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import { userAPI } from '@/api/user'
import { ElMessage } from 'element-plus'

const router = useRouter()
const loginForm = ref({
  username: '',
  password: ''
})

const handleLogin = async () => {
  try {
    const data = await userAPI.login(loginForm.value)
    
    // ä¿å­˜ token å’Œç”¨æˆ·ä¿¡æ¯
    localStorage.setItem('token', data.token)
    localStorage.setItem('userInfo', JSON.stringify(data.userInfo))
    
    ElMessage.success('ç™»å½•æˆåŠŸ')
    router.push('/')
  } catch (error) {
    // é”™è¯¯å·²åœ¨æ‹¦æˆªå™¨ä¸­å¤„ç†
  }
}
</script>

<template>
  <el-form :model="loginForm">
    <el-form-item label="ç”¨æˆ·å">
      <el-input v-model="loginForm.username" />
    </el-form-item>
    <el-form-item label="å¯†ç ">
      <el-input v-model="loginForm.password" type="password" />
    </el-form-item>
    <el-button @click="handleLogin">ç™»å½•</el-button>
  </el-form>
</template>
```

### 2. å•†å“åˆ—è¡¨é¡µ
```vue
<script setup>
import { ref, onMounted } from 'vue'
import { productAPI } from '@/api/product'

const productList = ref([])
const loading = ref(false)
const pagination = ref({
  page: 1,
  pageSize: 10,
  total: 0
})

const getProductList = async () => {
  loading.value = true
  try {
    const data = await productAPI.getList({
      page: pagination.value.page,
      pageSize: pagination.value.pageSize
    })
    
    productList.value = data.list
    pagination.value.total = data.total
  } catch (error) {
    // é”™è¯¯å·²åœ¨æ‹¦æˆªå™¨ä¸­å¤„ç†
  } finally {
    loading.value = false
  }
}

onMounted(() => {
  getProductList()
})
</script>

<template>
  <div v-loading="loading">
    <div v-for="product in productList" :key="product.productId">
      <img :src="product.image" />
      <h3>{{ product.name }}</h3>
      <p>Â¥{{ product.price }}</p>
    </div>
    
    <el-pagination
      v-model:current-page="pagination.page"
      :page-size="pagination.pageSize"
      :total="pagination.total"
      @current-change="getProductList"
    />
  </div>
</template>
```

### 3. æ·»åŠ åˆ°è´­ç‰©è½¦
```vue
<script setup>
import { cartAPI } from '@/api/cart'
import { ElMessage } from 'element-plus'

const addToCart = async (productId, quantity = 1) => {
  try {
    await cartAPI.add({ productId, quantity })
    ElMessage.success('å·²æ·»åŠ åˆ°è´­ç‰©è½¦')
  } catch (error) {
    // é”™è¯¯å·²åœ¨æ‹¦æˆªå™¨ä¸­å¤„ç†
  }
}
</script>

<template>
  <el-button @click="addToCart(1001, 1)">åŠ å…¥è´­ç‰©è½¦</el-button>
</template>
```

### 4. åˆ›å»ºè®¢å•
```vue
<script setup>
import { ref } from 'vue'
import { orderAPI } from '@/api/order'
import { ElMessage } from 'element-plus'
import { useRouter } from 'vue-router'

const router = useRouter()

const createOrder = async () => {
  try {
    const data = await orderAPI.create({
      addressId: 1,
      cartIds: [1, 2, 3],
      remark: 'è¯·å°½å¿«å‘è´§'
    })
    
    ElMessage.success('è®¢å•åˆ›å»ºæˆåŠŸ')
    router.push(`/order/${data.orderId}`)
  } catch (error) {
    // é”™è¯¯å·²åœ¨æ‹¦æˆªå™¨ä¸­å¤„ç†
  }
}
</script>
```

---

## ğŸ” çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰

### ç”¨æˆ·çŠ¶æ€ç®¡ç†
```javascript
// stores/user.js
import { defineStore } from 'pinia'
import { userAPI } from '@/api/user'

export const useUserStore = defineStore('user', {
  state: () => ({
    token: localStorage.getItem('token') || '',
    userInfo: JSON.parse(localStorage.getItem('userInfo') || '{}')
  }),

  getters: {
    isLogin: (state) => !!state.token
  },

  actions: {
    // ç™»å½•
    async login(loginForm) {
      const data = await userAPI.login(loginForm)
      this.token = data.token
      this.userInfo = data.userInfo
      
      localStorage.setItem('token', data.token)
      localStorage.setItem('userInfo', JSON.stringify(data.userInfo))
    },

    // ç™»å‡º
    logout() {
      this.token = ''
      this.userInfo = {}
      localStorage.removeItem('token')
      localStorage.removeItem('userInfo')
    },

    // è·å–ç”¨æˆ·ä¿¡æ¯
    async getUserInfo() {
      const data = await userAPI.getUserInfo()
      this.userInfo = data
      localStorage.setItem('userInfo', JSON.stringify(data))
    }
  }
})
```

### è´­ç‰©è½¦çŠ¶æ€ç®¡ç†
```javascript
// stores/cart.js
import { defineStore } from 'pinia'
import { cartAPI } from '@/api/cart'

export const useCartStore = defineStore('cart', {
  state: () => ({
    cartList: []
  }),

  getters: {
    // è´­ç‰©è½¦æ€»æ•°é‡
    cartCount: (state) => {
      return state.cartList.reduce((sum, item) => sum + item.quantity, 0)
    },

    // é€‰ä¸­å•†å“æ€»ä»·
    selectedTotal: (state) => {
      return state.cartList
        .filter(item => item.selected)
        .reduce((sum, item) => sum + item.price * item.quantity, 0)
    }
  },

  actions: {
    // è·å–è´­ç‰©è½¦åˆ—è¡¨
    async getCartList() {
      this.cartList = await cartAPI.getList()
    },

    // æ·»åŠ åˆ°è´­ç‰©è½¦
    async addToCart(productId, quantity) {
      await cartAPI.add({ productId, quantity })
      await this.getCartList()
    },

    // æ›´æ–°è´­ç‰©è½¦
    async updateCart(cartId, updates) {
      await cartAPI.update({ cartId, ...updates })
      await this.getCartList()
    },

    // åˆ é™¤è´­ç‰©è½¦å•†å“
    async deleteCart(cartId) {
      await cartAPI.delete(cartId)
      await this.getCartList()
    }
  }
})
```

---

## ğŸ›¡ï¸ è·¯ç”±å®ˆå«

```javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router'

const router = createRouter({
  history: createWebHistory(),
  routes: [
    {
      path: '/login',
      component: () => import('@/views/Login.vue')
    },
    {
      path: '/cart',
      component: () => import('@/views/Cart.vue'),
      meta: { requiresAuth: true }
    },
    {
      path: '/order',
      component: () => import('@/views/Order.vue'),
      meta: { requiresAuth: true }
    }
  ]
})

// è·¯ç”±å®ˆå«
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token')
  
  if (to.meta.requiresAuth && !token) {
    // éœ€è¦ç™»å½•ä½†æœªç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
    next('/login')
  } else {
    next()
  }
})

export default router
```

---

## ğŸ“ TypeScript ç±»å‹å®šä¹‰ï¼ˆå¯é€‰ï¼‰

```typescript
// types/user.ts
export interface LoginForm {
  username: string
  password: string
}

export interface UserInfo {
  userId: number
  username: string
  email: string
  phone: string
  avatar: string
}

export interface LoginResponse {
  token: string
  userInfo: UserInfo
}

// types/product.ts
export interface Product {
  productId: number
  name: string
  price: number
  originalPrice: number
  image: string
  description: string
  stock: number
  sales: number
  categoryId: number
  status: number
}

export interface ProductListParams {
  page?: number
  pageSize?: number
  categoryId?: number
  sortBy?: 'sales' | 'price' | 'createdAt'
  order?: 'asc' | 'desc'
}

// types/cart.ts
export interface CartItem {
  cartId: number
  productId: number
  productName: string
  productImage: string
  price: number
  quantity: number
  selected: boolean
  stock: number
}

// types/order.ts
export interface CreateOrderData {
  addressId: number
  cartIds: number[]
  remark?: string
}

export interface Order {
  orderId: number
  orderNo: string
  status: number
  statusText: string
  totalAmount: number
  products: OrderProduct[]
  address: OrderAddress
  createdAt: string
}
```

---

## âœ… æµ‹è¯•æ¸…å•

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] ç”¨æˆ·æ³¨å†Œ
- [ ] ç”¨æˆ·ç™»å½•
- [ ] è·å–ç”¨æˆ·ä¿¡æ¯
- [ ] Token è¿‡æœŸå¤„ç†

### å•†å“åŠŸèƒ½æµ‹è¯•
- [ ] å•†å“åˆ—è¡¨å±•ç¤º
- [ ] å•†å“è¯¦æƒ…å±•ç¤º
- [ ] å•†å“æœç´¢
- [ ] åˆ†é¡µåŠŸèƒ½

### è´­ç‰©è½¦åŠŸèƒ½æµ‹è¯•
- [ ] æ·»åŠ åˆ°è´­ç‰©è½¦
- [ ] è´­ç‰©è½¦åˆ—è¡¨
- [ ] æ›´æ–°æ•°é‡
- [ ] åˆ é™¤å•†å“
- [ ] é€‰ä¸­/å–æ¶ˆé€‰ä¸­

### è®¢å•åŠŸèƒ½æµ‹è¯•
- [ ] åˆ›å»ºè®¢å•
- [ ] è®¢å•åˆ—è¡¨
- [ ] è®¢å•è¯¦æƒ…
- [ ] å–æ¶ˆè®¢å•
- [ ] ç¡®è®¤æ”¶è´§

### åœ°å€åŠŸèƒ½æµ‹è¯•
- [ ] åœ°å€åˆ—è¡¨
- [ ] æ·»åŠ åœ°å€
- [ ] ç¼–è¾‘åœ°å€
- [ ] åˆ é™¤åœ°å€
- [ ] è®¾ç½®é»˜è®¤åœ°å€

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. è·¨åŸŸé—®é¢˜
å¦‚æœé‡åˆ°è·¨åŸŸé”™è¯¯ï¼Œæ£€æŸ¥ï¼š
- åç«¯æ˜¯å¦æ­£ç¡®é…ç½® CORS
- å‰ç«¯è¯·æ±‚åœ°å€æ˜¯å¦æ­£ç¡®
- æ˜¯å¦ä½¿ç”¨äº†ä»£ç†é…ç½®

### 2. Token å¤±æ•ˆ
Token æœ‰æ•ˆæœŸä¸º 7 å¤©ï¼Œå¤±æ•ˆåï¼š
- è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
- æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„ token å’Œ userInfo

### 3. è¯·æ±‚è¶…æ—¶
é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 10 ç§’ï¼Œå¯åœ¨ axios é…ç½®ä¸­è°ƒæ•´ï¼š
```javascript
timeout: 30000 // 30ç§’
```

### 4. å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜
ç¡®ä¿å›¾ç‰‡ URL å¯è®¿é—®ï¼Œå¯ä»¥æ·»åŠ é»˜è®¤å›¾ç‰‡ï¼š
```vue
<img :src="product.image" @error="handleImageError" />

<script>
const handleImageError = (e) => {
  e.target.src = '/default-product.png'
}
</script>
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´ API æ–‡æ¡£](./å‰åç«¯å¯¹æ¥æ–‡æ¡£.md)
- [Postman Collection](../postman_collection.json)
- [æ•°æ®åº“è®¾è®¡](./mongodb-design.md)

---

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸ‰
